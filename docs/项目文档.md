# CruchCount 项目文档

## 1. 项目背景

CruchCount 用于零食店收银场景，目标是在离线环境下，通过条码快速完成商品识别与结账。

应用特点：

- 无需联网，数据全部保存在本地。
- 支持扫码枪连续扫码。
- 支持手动条码输入与联想匹配。
- 未入库商品可临时定价，不中断收银。

## 2. 目标用户

- 零食店一线收银/理货工作人员。
- 需要快速完成入库和结账操作的门店。

## 3. 功能边界

本期仅实现两个页面，由主窗口两个按钮切换：

1. 入库页面
2. 购物车页面

不在本期范围：

- 云端同步
- 多门店账号体系
- 复杂促销规则（满减、会员价等）

## 4. 页面与交互设计

### 4.1 主窗口

- 顶部或侧边两个按钮：`入库`、`购物车`
- 点击按钮切换中央内容区页面
- 默认进入 `购物车`（推荐）或按产品决定

### 4.2 入库页面

#### 字段

- 条码（必填，唯一标识）
- 商品名称（必填）
- 售价（必填，正数）

#### 操作流程

1. 输入条码、名称、售价
2. 点击“保存/入库”
3. 系统按条码写入本地数据库

#### 规则

- 如果条码不存在：新增商品
- 如果条码已存在：覆盖更新（名称、售价）

#### 反馈

- 成功提示：新增成功/更新成功
- 失败提示：字段为空、售价非法等

### 4.3 购物车页面

#### 模块

- 扫码输入区（可聚焦输入框，接收扫码枪输入）
- 手动输入区（带联想下拉）
- 购物车列表（条码、名称、单价、数量、小计）
- 汇总区（总件数、总金额）
- 操作区（清空、结账）

#### 加购方式 A：扫码枪连续扫码

1. 扫码枪输出条码并触发回车
2. 系统根据条码查找商品
3. 命中商品：加入购物车
   - 若购物车已存在该条码：数量 `+1`
   - 若不存在：新增行，数量初始化 `1`
4. 未命中商品：弹出未入库提示对话框

#### 加购方式 B：手动输入条码

1. 在手动输入框输入字符
2. 下拉框实时展示匹配商品（按条码前缀或名称关键词匹配）
3. 选择候选商品后加入购物车

#### 未入库商品弹窗（关键流程）

弹窗信息：

- 标题：未入库商品
- 展示内容：当前条码
- 输入项：临时售价（必填，正数）

按钮行为：

- `确认加入`：以“临时商品”加入购物车（名称可默认 `临时商品-<条码后4位>`）
- `取消`：不加入购物车，返回扫码状态

设计原则：

- 不阻断收银节奏，扫码后可快速继续下一件
- 临时商品仅作用于当前购物车（推荐），避免污染商品库

## 5. 数据设计（本地）

推荐使用 SQLite。

### 5.1 商品表 `products`

- `barcode` TEXT PRIMARY KEY
- `name` TEXT NOT NULL
- `price` REAL NOT NULL
- `updated_at` TEXT NOT NULL

约束建议：

- `price > 0`
- `barcode` 去除首尾空格后保存

### 5.2 购物车数据（运行时）

可先放内存结构，不强制落库：

- `barcode`
- `name`
- `price`
- `quantity`
- `subtotal`

## 6. 关键业务规则

1. 条码是唯一键。
2. 入库重复条码执行覆盖更新。
3. 购物车重复条码仅增数量，不新增重复行。
4. 所有金额字段必须为正数并保留两位小数显示。
5. 未入库条码允许临时定价加入购物车。

## 7. 异常与提示

- 条码为空：提示“请输入条码”
- 售价非法：提示“请输入有效售价”
- 查询不到商品：提示“该商品未入库，可输入临时价格继续结账”
- 数据库异常：提示“本地数据写入失败，请重试”

## 8. 验收标准（MVP）

### 8.1 入库

- 可新增商品
- 相同条码可覆盖更新
- 非法输入可阻止提交并提示

### 8.2 购物车

- 扫码枪可连续扫码加入
- 手动输入可联想并加入
- 重复商品数量正确累计
- 总金额计算正确

### 8.3 未入库流程

- 扫到未入库条码必弹窗
- 可输入临时价格并继续加购
- 不中断后续扫码

### 8.4 离线能力

- 断网环境下可完整完成入库与购物车流程

## 9. 开发建议（实现顺序）

1. 主窗口 + 两页面切换框架
2. 商品表与入库逻辑（新增/覆盖）
3. 购物车表格与金额计算
4. 扫码输入处理（回车触发）
5. 手动输入联想下拉
6. 未入库弹窗与临时定价加入
7. 基础异常提示与输入校验

## 10. 后续可扩展项

- 结账小票打印
- 日结统计（销售额、热销商品）
- 临时商品二次确认是否写回商品库
- 快捷键优化（全键盘收银）
